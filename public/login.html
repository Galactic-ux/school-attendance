<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login - School Attendance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  <link rel="stylesheet" href="/assets/styles.css">
</head>
<body class="bg-gray-100 font-poppins">
  <div class="flex h-screen">
    <!-- Left side with image -->
    <div class="hidden lg:flex items-center justify-center flex-1 bg-indigo-600 text-white">
      <div class="max-w-md text-center">
        <h1 class="text-4xl font-bold mb-4">Welcome to the Future of Attendance</h1>
        <p class="text-indigo-200">Automated, accurate, and effortless attendance tracking for rural schools in the modern era.</p>
        
      </div>
    </div>

    <!-- Right side with login form -->
    <div class="w-full lg:w-1/2 flex items-center justify-center">
      <div class="max-w-md w-full p-8">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-800">Login to Your Account</h2>
          <p class="text-gray-500">Please enter your credentials to continue</p>
        </div>
        
        <div class="space-y-6">
          <div>
            <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
            <div class="mt-1 flex rounded-md shadow-sm">
              <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                <i class="fas fa-user"></i>
              </span>
              <input id="username" placeholder="Enter your username" class="input-field flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300"/>
            </div>
          </div>
          
          <div>
            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
            <div class="mt-1 flex rounded-md shadow-sm">
              <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                <i class="fas fa-lock"></i>
              </span>
              <input id="password" type="password" placeholder="Enter your password" class="input-field flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300"/>
            </div>
          </div>
        </div>

        <div class="mt-8">
          <button id="loginBtn" class="btn btn-primary w-full">
            <i class="fas fa-sign-in-alt mr-2"></i>
            Login
          </button>
        </div>

        <p id="err" class="text-red-500 mt-4 text-center"></p>
      </div>
    </div>
  </div>

<script>
async function doLogin(username,password){
  const res = await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
  if(!res.ok) {
    const err = await res.json().catch(()=>({error:'Login failed'}));
    throw new Error(err.error || 'Login failed');
  }
  return res.json();
}

document.getElementById('loginBtn').onclick = async ()=>{
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  try{
    const data = await doLogin(u,p);
    localStorage.setItem('token', data.token);
    localStorage.setItem('role', data.role);
    if(data.linkedStudentId) localStorage.setItem('linkedStudentId', data.linkedStudentId);
    if(data.role === 'student') window.location.href = '/student.html';
    else if(data.role === 'faculty') window.location.href = '/faculty.html';
    else window.location.href = '/admin.html';
  }catch(e){ document.getElementById('err').innerText = e.message; }
};
</script>
</body>
</html>